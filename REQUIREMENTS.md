# 项目需求说明

## 1. 项目背景
现代高层建筑的垂直交通效率直接影响用户体验与能耗。传统基于固定规则的电梯调度在复杂客流下表现不佳。本项目旨在构建可模拟真实电梯运行的环境，支持规则算法、优化方法与机器学习/强化学习，用于自动学习与优化调度策略，最终形成可复用的电梯仿真引擎（LiftSim）与可扩展的策略接口。

## 2. 项目目标
- 构建可运行、可扩展的 18 层 / 2 部电梯仿真环境。
- 支持规则调度（贪心、同向优先）并为 RL/优化算法预留接口。
- 提供可衡量策略优劣的指标体系，形成可复用的 LiftSim 引擎。

## 3. 功能需求
### 3.1 仿真环境
- 离散时间步仿真：1 秒 = 1 step；电梯速度 3 m/s，层高 3 m（约 1 层 ≈ 1 秒移动）。
- 电梯数量：2；楼层数量：18；停靠时间：每次停站固定 5 秒（用于开关门与上下客，计入调度/周转时间，乘客到达本层后的下车时间不再额外累加）；满载时外部楼层不启门，内部到站才开门。
- 乘客生成：随机/高峰模式；每秒以概率 p 生成乘客（默认 p=0.2），起终楼层不同。
- 核心循环：时间推进 → 电梯状态更新（移动/停靠/空闲）→ 上下客逻辑 → 仿真结束统计。

### 3.2 乘客模型
- 属性：出现时间、起始楼层、目的楼层、等待时间、乘梯时间、所属电梯。
- 生成：全局每秒以概率 p 生成新乘客（默认 p=0.2），起终楼层不同；后续可扩展上/下行高峰与午间随机。

### 3.3 调度模块
- 默认策略：分配至预计到达时间（ETA）最小的电梯；满载时电梯跳过，新乘客由调度器即时改派。
- 可扩展：插队/队列优化、分布式调度、多策略对比（baseline vs RL），算法可插拔。

### 3.4 指标体系
- 必备：平均/最大等待时间（上车-出现）；平均/最大乘梯时间（到达-上车）；p95/p99 等分位等待时长；完成乘客数与拒载/超时数；系统负载分布（各层/时间段请求数）；电梯利用率（载客率、运行时间占比）。
+- 评估周期：默认模拟 1 小时；记录随机种子，便于复现。可扩展：能耗（与距离相关）、策略稳定性（不同客流场景）。

## 4. 非功能需求
- 可扩展性：易增减电梯/楼层、替换调度算法、RL 接入（gym 化为默认目标）、多客流模型。
- 性能：单次 1 小时仿真 < 1 秒（普通 PC）；支持并行 100~1000 次仿真用于训练。
- 可维护性：模块化（Elevator, Passenger, Environment, Dispatcher），关键逻辑清晰可拓展。

## 5. 技术需求
- 语言：Python 3.8+；核心依赖标准库，避免 heavy 库。
- 可选：gymnasium（RL 接口）、numpy、matplotlib（可视化）、stable-baselines3（RL 实验）。

## 6. 系统架构（MVP）
Passenger Model → Elevator Model（状态机：Idle/Move，上下客逻辑，容量检查） → LiftSim Environment（时间推进、乘客生成、指标统计） → Dispatcher（贪心/优化/未来 RL，可插拔）。

## 6.1 Gym 化接口（起步即支持）
- Observation：每部电梯的位置、速度/方向、门状态、载客人数、目的队列；各层上下行队列长度（可截断/聚合）；时间步。
- Action：离散或参数化动作（如为待分配乘客选择电梯/目标楼层，或下达目标楼层列表）；需支持无效动作屏蔽（满载/越界）。
- Reward：建议负的等待时间增量与乘梯时间增量之和，附加拒载/超时惩罚，鼓励低等待且高完成率；可选能耗惩罚。
- Termination：默认 1 小时模拟或队列清空；支持 seed 复现。

## 7. MVP
- 18 层 × 2 部电梯 × 离散仿真引擎。
- 简化 ETA 调度算法。
- 完整乘客生命周期（出现→等待→乘梯→结束）。
- 输出平均等待时间等基础指标。

## 8. 未来路线图
- V1.0：仿真环境 + 贪心调度。
- V1.1：插队/队列优化。
- V1.2：场景扩展（高峰模式、群控）。
- V1.3：gym 化接口。
- V1.4：RL 调度策略（PPO/DQN）。
- V2.0：多电梯群控、复杂客流、高维状态空间。
- V2.5：可视化前端 & 楼宇数字孪生。
- V3.0：商用决策引擎（智能群控系统）。
